var Diablo=function(){var n=typeof document!="undefined"&&document.currentScript?document.currentScript.src:undefined;return function(t){function ku(n){return i.locateFile?i.locateFile(n,a):a+n}function ai(n,t,r){return r&&r.length?i["dynCall_"+n].apply(null,[t].concat(r)):i["dynCall_"+n].call(null,t)}function b(n,t){n||c("Assertion failed: "+t)}function yr(n){var t=i["_"+n];return b(t,"Cannot call unknown function "+n+", make sure it is exported"),t}function ef(n,t,i,r){function a(n){return t==="string"?at(n):t==="boolean"?Boolean(n):n}var l={string:function(n){var t=0,i;return n!==null&&n!==undefined&&n!==0&&(i=(n.length<<2)+1,t=ei(i),wr(n,t,i)),t},array:function(n){var t=ei(n.length);return sf(n,t),t}},v=yr(n),o=[],f=0,u,c,e;if(r)for(u=0;u<r.length;u++)c=l[i[u]],c?(f===0&&(f=h()),o[u]=c(r[u])):o[u]=r[u];return e=v.apply(null,o),e=a(e),f!==0&&s(f),e}function pr(n,t,i){for(var h=t+i,u=t,f,r,e,o,s;n[u]&&!(u>=h);)++u;if(u-t>16&&n.subarray&&vi)return vi.decode(n.subarray(t,u));for(f="";t<u;){if(r=n[t++],!(r&128)){f+=String.fromCharCode(r);continue}if(e=n[t++]&63,(r&224)==192){f+=String.fromCharCode((r&31)<<6|e);continue}o=n[t++]&63;r=(r&240)==224?(r&15)<<12|e<<6|o:(r&7)<<18|e<<12|o<<6|n[t++]&63;r<65536?f+=String.fromCharCode(r):(s=r-65536,f+=String.fromCharCode(55296|s>>10,56320|s&1023))}return f}function at(n,t){return n?pr(u,n,t):""}function ni(n,t,i,r){var o,f,e,u,s;if(!(r>0))return 0;for(o=i,f=i+r-1,e=0;e<n.length;++e)if(u=n.charCodeAt(e),u>=55296&&u<=57343&&(s=n.charCodeAt(++e),u=65536+((u&1023)<<10)|s&1023),u<=127){if(i>=f)break;t[i++]=u}else if(u<=2047){if(i+1>=f)break;t[i++]=192|u>>6;t[i++]=128|u&63}else if(u<=65535){if(i+2>=f)break;t[i++]=224|u>>12;t[i++]=128|u>>6&63;t[i++]=128|u&63}else{if(i+3>=f)break;t[i++]=240|u>>18;t[i++]=128|u>>12&63;t[i++]=128|u>>6&63;t[i++]=128|u&63}return t[i]=0,i-o}function wr(n,t,i){return ni(n,u,t,i)}function sf(n,t){r.set(n,t)}function br(n,t){return n%t>0&&(n+=t-n%t),n}function kr(n){it=n;i.HEAP8=r=new Int8Array(n);i.HEAP16=d=new Int16Array(n);i.HEAP32=f=new Int32Array(n);i.HEAPU8=u=new Uint8Array(n);i.HEAPU16=cf=new Uint16Array(n);i.HEAPU32=lf=new Uint32Array(n);i.HEAPF32=ii=new Float32Array(n);i.HEAPF64=pi=new Float64Array(n)}function ri(n){for(var t,r;n.length>0;){if(t=n.shift(),typeof t=="function"){t();continue}r=t.func;typeof r=="number"?t.arg===undefined?i.dynCall_v(r):i.dynCall_vi(r,t.arg):r(t.arg===undefined?null:t.arg)}}function vf(){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)kf(i.preRun.shift());ri(gr)}function yf(){iu=!0;ri(bi)}function pf(){ri(nu)}function wf(){af=!0}function bf(){if(i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;)ru(i.postRun.shift());ri(tu)}function kf(n){gr.unshift(n)}function ru(n){tu.unshift(n)}function ie(){g++;i.monitorRunDependencies&&i.monitorRunDependencies(g)}function re(){if(g--,i.monitorRunDependencies&&i.monitorRunDependencies(g),g==0&&(ki!==null&&(clearInterval(ki),ki=null),vt)){var n=vt;vt=null;n()}}function c(n){if(i.onAbort)i.onAbort(n);n+="";ci(n);y(n);gt=!0;vr=1;throw"abort("+n+"). Build with -s ASSERTIONS=1 for more info.";}function uu(n){return String.prototype.startsWith?n.startsWith(di):n.indexOf(di)===0}function fu(){try{if(lt)return new Uint8Array(lt);if(st)return st(p);throw"both async and sync fetching of the wasm failed";}catch(n){c(n)}}function fe(){return!lt&&(ot||k)&&typeof fetch=="function"?fetch(p,{credentials:"same-origin"}).then(function(n){if(!n.ok)throw"failed to load wasm binary file at '"+p+"'";return n.arrayBuffer()}).catch(function(){return fu()}):new Promise(function(n){n(fu())})}function ee(){function r(n){var t=n.exports;i.asm=t;re("wasm-instantiate")}function t(n){r(n.instance)}function u(t){return fe().then(function(t){return WebAssembly.instantiate(t,n)}).then(t,function(n){y("failed to asynchronously prepare wasm: "+n);c(n)})}function f(){if(lt||typeof WebAssembly.instantiateStreaming!="function"||uu(p)||typeof fetch!="function")return u(t);fetch(p,{credentials:"same-origin"}).then(function(i){var r=WebAssembly.instantiateStreaming(i,n);return r.then(t,function(n){y("wasm streaming compile failed: "+n);y("falling back to ArrayBuffer instantiation");u(t)})})}var n={env:rr,wasi_unstable:rr,global:{NaN:NaN,Infinity:Infinity},"global.Math":Math,asm2wasm:tf};if(ie("wasm-instantiate"),i.instantiateWasm)try{return i.instantiateWasm(n,r)}catch(e){return y("Module.instantiateWasm callback failed with error: "+e),!1}return f(),{}}function oe(n,t){return eu[n](t)}function se(){self.DApi.close_keyboard()}function he(n,t,i,r,u){self.DApi.open_keyboard(n,t,i,r,u)}function ce(n,t,i){self.DApi.create_sound(n,u.slice(t,t+i))}function le(n,t,i,r,u){self.DApi.create_sound_raw(n,ii.slice(t/4,t/4+i*r),i,r,u)}function ae(n){self.DApi.delete_sound(n)}function ve(){self.DApi.draw_begin()}function ye(n){self.DApi.draw_belt(f.subarray(n/4,n/4+8))}function pe(n,t,i,r,f){self.DApi.draw_blit(n,t,i,r,u.subarray(f,f+i*r*4))}function we(n,t,i,r){self.DApi.draw_clip_text(n,t,i,r)}function be(){self.DApi.draw_end()}function ke(n,t,i,r){var f=u.indexOf(0,i),e=String.fromCharCode.apply(null,u.subarray(i,f));self.DApi.draw_text(n,t,e,r)}function de(n,t){self.DApi.duplicate_sound(n,t)}function ge(){self.DApi.exit_game()}function no(n,t,i,r){self.DApi.play_sound(n,t,i,r)}function to(n,t){self.DApi.set_cursor(n,t)}function io(n,t){self.DApi.set_volume(n,t)}function ro(n){self.DApi.stop_sound(n)}function uo(n){self.DApi.use_websocket(n)}function fo(){return self.DApi.websocket_closed()}function eo(n,t){self.DApi.websocket_send(u.subarray(n,n+t))}function oo(n){var t=u.indexOf(0,n),i=String.fromCharCode.apply(null,u.subarray(n,t));self.DApi.exit_error(i)}function so(n,t,i,r){var f=u.indexOf(0,n),e=String.fromCharCode.apply(null,u.subarray(n,f));self.DApi.get_file_contents(e,u.subarray(t,t+r),i)}function ho(n){var t=u.indexOf(0,n),i=String.fromCharCode.apply(null,u.subarray(n,t));return self.DApi.get_file_size(i)}function co(n,t,i){var r=u.indexOf(0,n),f=String.fromCharCode.apply(null,u.subarray(n,r));self.DApi.put_file_contents(f,u.slice(t,t+i))}function lo(n){var t=u.indexOf(0,n),i=String.fromCharCode.apply(null,u.subarray(n,t));self.DApi.remove_file(i)}function ao(n){var t=u.indexOf(0,n),i=String.fromCharCode.apply(null,u.subarray(n,t));self.alert(i)}function vo(){self.WASM_TRACE&&self.WASM_TRACE.pop()}function yo(n){var i=u.indexOf(0,n),t=String.fromCharCode.apply(null,u.subarray(n,i));console.log(t);self.WASM_TRACE=self.WASM_TRACE||[];self.WASM_TRACE.push(t)}function ou(n){return n}function su(n){return n.replace(/\b__Z[\w\d_]+/g,function(n){var t=ou(n);return n===t?n:t+" ["+n+"]"})}function hu(){var n=new Error;if(!n.stack){try{throw new Error(0);}catch(t){n=t}if(!n.stack)return"(no stack trace available)"}return n.stack.toString()}function po(){var n=hu();return i.extraStackTrace&&(n+="\n"+i.extraStackTrace()),su(n)}function wo(n,t,i,r){c("Assertion failed: "+at(n)+", at: "+[t?at(t):"unknown filename",i,r?at(r):"unknown function"])}function bo(n){return fi(n)}function cu(n){if(n){var t=v[n];t.refcount++}}function tr(n){var i,t;if(!n||v[n])return n;for(i in v){var r=+i,u=v[r].adjusted,f=u.length;for(t=0;t<f;t++)if(u[t]===n)return r}return n}function ko(n){var t=v[n];return t&&!t.caught&&(t.caught=!0,yt.uncaught_exceptions--),t&&(t.rethrown=!1),nr.push(n),cu(tr(n)),n}function lu(n){try{return gh(n)}catch(t){}}function au(n){if(n){var t=v[n];t.refcount--;t.refcount!==0||t.rethrown||(t.destructor&&i.dynCall_vi(t.destructor,n),delete v[n],lu(n))}}function go(){o(0);var n=nr.pop();n&&(au(tr(n)),ut=0)}function ns(n){ut||(ut=n);throw n;}function ui(){var n=ut,u,i,t;if(!n)return(ct(0),0)|0;if(u=v[n],i=u.type,!i)return(ct(0),n)|0;var r=Array.prototype.slice.call(arguments),o=dh(i),e=1875728;for(f[e>>2]=n,n=e,t=0;t<r.length;t++)if(r[t]&&kh(r[t],i,n))return n=f[n>>2],u.adjusted.push(n),(ct(r[t]),n)|0;return n=f[n>>2],(ct(i),n)|0}function ts(n,t){return ui(n,t)}function is(n,t,i){return ui(n,t,i)}function rs(n){return n}function us(){gt=!0;throw"Pure virtual function called!";}function fs(n,t,i){v[n]={ptr:n,adjusted:[n],type:t,destructor:i,refcount:0,caught:!1,rethrown:!1};ut=n;"uncaught_exception"in yt?yt.uncaught_exceptions++:yt.uncaught_exceptions=1;throw n;}function es(){return yt.uncaught_exceptions}function os(){}function ss(){}function hs(n,t){e.varargs=t;try{var r=e.getStreamFromFD(),u=e.get(),f=e.get(),o=e.get(),s=e.get();return 0}catch(i){return typeof FS!="undefined"&&i instanceof FS.ErrnoError||c(i),-i.errno}}function cs(n,t){e.varargs=t;try{var r=e.getStreamFromFD();return 0}catch(i){return typeof FS!="undefined"&&i instanceof FS.ErrnoError||c(i),-i.errno}}function ls(){}function as(){var t=i._fflush,n;t&&t(0);n=e.buffers;n[1].length&&e.printChar(1,10);n[2].length&&e.printChar(2,10)}function vu(n,t,i,r){var h,o,v,l,s;try{for(h=0,o=0;o<i;o++){for(v=f[t+o*8>>2],l=f[t+(o*8+4)>>2],s=0;s<l;s++)e.printChar(n,u[v+s]);h+=l}return f[r>>2]=h,0}catch(a){return typeof FS!="undefined"&&a instanceof FS.ErrnoError||c(a),-a.errno}}function vs(){return vu.apply(null,arguments)}function ys(){c()}function ir(){return r.length}function ws(){c("OOM")}function yu(n){try{return tt.grow(n-it.byteLength+65535>>16),kr(tt.buffer),1}catch(t){}}function bs(n){var e=ir(),i=65536,r=2147483648-i,u,t,f;if(n>r)return!1;for(u=16777216,t=Math.max(e,u);t<n;)t=t<=536870912?br(2*t,i):Math.min(br((3*t+2147483648)/4,i),r);return(f=yu(t),!f)?!1:!0}function ks(n){dc(n)}function ds(n){return n}function gs(){c("trap!")}function nh(n,t,i){u.set(u.subarray(t,t+i),n)}function th(n){var t=Date.now()/1e3|0;return n&&(f[n>>2]=t),t}function ih(n){var i=h();try{return tc(n)}catch(t){if(s(i),t!==t+0&&t!=="longjmp")throw t;o(1,0)}}function rh(n,t){var r=h();try{return ic(n,t)}catch(i){if(s(r),i!==i+0&&i!=="longjmp")throw i;o(1,0)}}function uh(n,t,i){var u=h();try{return rc(n,t,i)}catch(r){if(s(u),r!==r+0&&r!=="longjmp")throw r;o(1,0)}}function fh(n,t,i,r){var f=h();try{return uc(n,t,i,r)}catch(u){if(s(f),u!==u+0&&u!=="longjmp")throw u;o(1,0)}}function eh(n,t,i,r,u){var e=h();try{return fc(n,t,i,r,u)}catch(f){if(s(e),f!==f+0&&f!=="longjmp")throw f;o(1,0)}}function oh(n,t,i,r,u,f){var c=h();try{return ec(n,t,i,r,u,f)}catch(e){if(s(c),e!==e+0&&e!=="longjmp")throw e;o(1,0)}}function sh(n,t){var r=h();try{return oc(n,t)}catch(i){if(s(r),i!==i+0&&i!=="longjmp")throw i;o(1,0)}}function hh(n){var i=h();try{sc(n)}catch(t){if(s(i),t!==t+0&&t!=="longjmp")throw t;o(1,0)}}function ch(n,t){var r=h();try{hc(n,t)}catch(i){if(s(r),i!==i+0&&i!=="longjmp")throw i;o(1,0)}}function lh(n,t,i){var u=h();try{cc(n,t,i)}catch(r){if(s(u),r!==r+0&&r!=="longjmp")throw r;o(1,0)}}function ah(n,t,i,r){var f=h();try{lc(n,t,i,r)}catch(u){if(s(f),u!==u+0&&u!=="longjmp")throw u;o(1,0)}}function vh(n,t,i,r,u){var e=h();try{ac(n,t,i,r,u)}catch(f){if(s(e),f!==f+0&&f!=="longjmp")throw f;o(1,0)}}function yh(n,t,i,r,u,f){var c=h();try{vc(n,t,i,r,u,f)}catch(e){if(s(c),e!==e+0&&e!=="longjmp")throw e;o(1,0)}}function ph(n,t,i,r,u,f,e,c){var a=h();try{yc(n,t,i,r,u,f,e,c)}catch(l){if(s(a),l!==l+0&&l!=="longjmp")throw l;o(1,0)}}function wh(n,t,i,r,u){var e=h();try{pc(n,t,i,r,u)}catch(f){if(s(e),f!==f+0&&f!=="longjmp")throw f;o(1,0)}}function bh(n,t,i,r,u){var e=h();try{wc(n,t,i,r,u)}catch(f){if(s(e),f!==f+0&&f!=="longjmp")throw f;o(1,0)}}function bu(n){this.name="ExitStatus";this.message="Program terminated with exit("+n+")";this.status=n}function ur(n){function t(){pt||(pt=!0,gt)||(yf(),pf(),i.onRuntimeInitialized&&i.onRuntimeInitialized(),bf())}(n=n||et,g>0)||(vf(),g>0)||(i.setStatus?(i.setStatus("Running..."),setTimeout(function(){setTimeout(function(){i.setStatus("")},1);t()},1)):t())}function dc(n,t){if(!t||!dt||n!==0){if(!dt&&(gt=!0,vr=n,wf(),i.onExit))i.onExit(n);wt(n,new bu(n))}}var i,nt,w,a,bt,du,st,gu,si,hi,ci,y,sr,kt,dt,vi,yi,it,r,u,d,cf,f,lf,ii,pi,ue,di,p,rt,gi,eu,l,v,nr,ut,ft,e,ps,pu,pt,bc;t=t||{};i=typeof t!="undefined"?t:{};nt={};for(w in i)i.hasOwnProperty(w)&&(nt[w]=i[w]);var et=[],fr="./this.program",wt=function(n,t){throw t;},ot=!1,k=!1,oi=!1,er=!1,or=!1;if(ot=typeof window=="object",k=typeof importScripts=="function",er=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",oi=er&&!ot&&!k,or=!ot&&!oi&&!k,a="",oi){a=__dirname+"/";bt=function(n,t){var i;return si||(si=require("fs")),hi||(hi=require("path")),n=hi.normalize(n),i=si.readFileSync(n),t?i:i.toString()};st=function(n){var t=bt(n,!0);return t.buffer||(t=new Uint8Array(t)),b(t.buffer),t};process.argv.length>1&&(fr=process.argv[1].replace(/\\/g,"/"));et=process.argv.slice(2);process.on("uncaughtException",function(n){if(!(n instanceof bu))throw n;});process.on("unhandledRejection",c);wt=function(n){process.exit(n)};i.inspect=function(){return"[Emscripten Module object]"}}else or?(typeof read!="undefined"&&(bt=function(n){return read(n)}),st=function(n){var t;return typeof readbuffer=="function"?new Uint8Array(readbuffer(n)):(t=read(n,"binary"),b(typeof t=="object"),t)},typeof scriptArgs!="undefined"?et=scriptArgs:typeof arguments!="undefined"&&(et=arguments),typeof quit=="function"&&(wt=function(n){quit(n)}),typeof print!="undefined"&&(typeof console=="undefined"&&(console={}),console.log=print,console.warn=console.error=typeof printErr!="undefined"?printErr:print)):(ot||k)&&(k?a=self.location.href:document.currentScript&&(a=document.currentScript.src),n&&(a=n),a=a.indexOf("blob:")!==0?a.substr(0,a.lastIndexOf("/")+1):"",bt=function(n){var t=new XMLHttpRequest;return t.open("GET",n,!1),t.send(null),t.responseText},k&&(st=function(n){var t=new XMLHttpRequest;return t.open("GET",n,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),du=function(n,t,i){var r=new XMLHttpRequest;r.open("GET",n,!0);r.responseType="arraybuffer";r.onload=function(){if(r.status==200||r.status==0&&r.response){t(r.response);return}i()};r.onerror=i;r.send(null)},gu=function(n){document.title=n});ci=i.print||console.log.bind(console);y=i.printErr||console.warn.bind(console);for(w in nt)nt.hasOwnProperty(w)&&(i[w]=nt[w]);nt=null;i.arguments&&(et=i.arguments);i.thisProgram&&(fr=i.thisProgram);i.quit&&(wt=i.quit);sr=16;var tf={"f64-rem":function(n,t){return n%t},"debugger":function(){}},cr=1,li=new Array(0);kt={};var lr=0,ct=function(n){lr=n},uf=function(){return lr},lt;i.wasmBinary&&(lt=i.wasmBinary);i.noExitRuntime&&(dt=i.noExitRuntime);typeof WebAssembly!="object"&&y("no native wasm support detected");var tt,ar=new WebAssembly.Table({initial:1118,maximum:1118,element:"anyfunc"}),gt=!1,vr=0;var of=3;vi=typeof TextDecoder!="undefined"?new TextDecoder("utf8"):undefined;yi=typeof TextDecoder!="undefined"?new TextDecoder("utf-16le"):undefined;var wi=1875536,dr=i.TOTAL_MEMORY||134217728;tt=i.wasmMemory?i.wasmMemory:new WebAssembly.Memory({initial:dr/65536});tt&&(it=tt.buffer);dr=it.byteLength;kr(it);f[wi>>2]=7118640;var gr=[],bi=[],nu=[],tu=[],iu=!1,af=!1;var df=Math.abs,oa=Math.cos,sa=Math.sin,ha=Math.tan,ca=Math.acos,la=Math.asin,aa=Math.atan,va=Math.atan2,ya=Math.exp,pa=Math.log,wa=Math.sqrt,gf=Math.ceil,ne=Math.floor,ba=Math.pow,ka=Math.imul,da=Math.fround,ga=Math.round,te=Math.min,nv=Math.max,tv=Math.clz32,iv=Math.trunc,g=0,ki=null,vt=null;i.preloadedImages={};i.preloadedAudios={};ue=null;di="data:application/octet-stream;base64,";p="Diablo.wasm";uu(p)||(p=ku(p));i.asm=ee;eu=[function(n){self.DApi.current_save_id(n)}];bi.push({func:function(){nc()}});l=1875744;v={};nr=[];ut=0;i.___cxa_find_matching_catch=ui;ft={splitPath:function(n){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(n).slice(1)},normalizeArray:function(n,t){for(var u,r=0,i=n.length-1;i>=0;i--)u=n[i],u==="."?n.splice(i,1):u===".."?(n.splice(i,1),r++):r&&(n.splice(i,1),r--);if(t)for(;r;r--)n.unshift("..");return n},normalize:function(n){var t=n.charAt(0)==="/",i=n.substr(-1)==="/";return n=ft.normalizeArray(n.split("/").filter(function(n){return!!n}),!t).join("/"),n||t||(n="."),n&&i&&(n+="/"),(t?"/":"")+n},dirname:function(n){var i=ft.splitPath(n),r=i[0],t=i[1];return!r&&!t?".":(t&&(t=t.substr(0,t.length-1)),r+t)},basename:function(n){if(n==="/")return"/";var t=n.lastIndexOf("/");return t===-1?n:n.substr(t+1)},extname:function(n){return ft.splitPath(n)[3]},join:function(){var n=Array.prototype.slice.call(arguments,0);return ft.normalize(n.join("/"))},join2:function(n,t){return ft.normalize(n+"/"+t)}};e={buffers:[null,[],[]],printChar:function(n,t){var i=e.buffers[n];t===0||t===10?((n===1?ci:y)(pr(i,0)),i.length=0):i.push(t)},varargs:0,get:function(){e.varargs+=4;return f[e.varargs-4>>2]},getStr:function(){return at(e.get())},get64:function(){var n=e.get(),t=e.get();return n},getZero:function(){e.get()}};ps=!0;pu=!1;var rr={___assert_fail:wo,___cxa_allocate_exception:bo,___cxa_begin_catch:ko,___cxa_end_catch:go,___cxa_find_matching_catch:ui,___cxa_find_matching_catch_2:ts,___cxa_find_matching_catch_3:is,___cxa_free_exception:lu,___cxa_get_exception_ptr:rs,___cxa_pure_virtual:us,___cxa_throw:fs,___cxa_uncaught_exceptions:es,___exception_addRef:cu,___exception_deAdjust:tr,___exception_decRef:au,___gxx_personality_v0:os,___lock:ss,___resumeException:ns,___syscall140:hs,___syscall6:cs,___unlock:ls,___wasi_fd_write:vs,__api_close_keyboard:se,__api_open_keyboard:he,__memory_base:1024,__table_base:0,_abort:ys,_api_create_sound:ce,_api_create_sound_float:le,_api_delete_sound:ae,_api_draw_begin:ve,_api_draw_belt:ye,_api_draw_blit:pe,_api_draw_clip_text:we,_api_draw_end:be,_api_draw_text:ke,_api_duplicate_sound:de,_api_exit_game:ge,_api_play_sound:no,_api_set_cursor:to,_api_set_volume:io,_api_stop_sound:ro,_api_use_websocket:uo,_api_websocket_closed:fo,_api_websocket_send:eo,_emscripten_asm_const_ii:oe,_emscripten_get_heap_size:ir,_emscripten_memcpy_big:nh,_emscripten_resize_heap:bs,_exit:ks,_exit_error:oo,_fd_write:vu,_get_file_contents:so,_get_file_size:ho,_llvm_eh_typeid_for:ds,_llvm_trap:gs,_put_file_contents:co,_remove_file:lo,_show_alert:ao,_time:th,_trace_pop:vo,_trace_push:yo,abort:c,abortOnCannotGrowMemory:ws,demangle:ou,demangleAll:su,emscripten_realloc_buffer:yu,flush_NO_FILESYSTEM:as,getTempRet0:uf,invoke_i:ih,invoke_ii:rh,invoke_iii:uh,invoke_iiii:fh,invoke_iiiii:eh,invoke_iiiiii:oh,invoke_ji:sh,invoke_v:hh,invoke_vi:ch,invoke_vii:lh,invoke_viii:ah,invoke_viiii:vh,invoke_viiiii:yh,invoke_viiiiiii:ph,invoke_viij:wh,invoke_viji:bh,jsStackTrace:hu,memory:tt,setTempRet0:ct,stackTrace:po,table:ar,tempDoublePtr:l},wu=i.asm({},rr,it);i.asm=wu;var sv=i._DApi_AllocPacket=function(){return i.asm._DApi_AllocPacket.apply(null,arguments)},hv=i._DApi_Char=function(){return i.asm._DApi_Char.apply(null,arguments)},cv=i._DApi_Init=function(){return i.asm._DApi_Init.apply(null,arguments)},lv=i._DApi_Key=function(){return i.asm._DApi_Key.apply(null,arguments)},av=i._DApi_Mouse=function(){return i.asm._DApi_Mouse.apply(null,arguments)},vv=i._DApi_Render=function(){return i.asm._DApi_Render.apply(null,arguments)},yv=i._DApi_SyncText=function(){return i.asm._DApi_SyncText.apply(null,arguments)},pv=i._DApi_SyncTextPtr=function(){return i.asm._DApi_SyncTextPtr.apply(null,arguments)},wv=i._SNet_InitWebsocket=function(){return i.asm._SNet_InitWebsocket.apply(null,arguments)},bv=i._SNet_WebsocketStatus=function(){return i.asm._SNet_WebsocketStatus.apply(null,arguments)},yt=i.__ZSt18uncaught_exceptionv=function(){return i.asm.__ZSt18uncaught_exceptionv.apply(null,arguments)},kh=i.___cxa_can_catch=function(){return i.asm.___cxa_can_catch.apply(null,arguments)},dh=i.___cxa_is_pointer_type=function(){return i.asm.___cxa_is_pointer_type.apply(null,arguments)},kv=i.___em_js___api_close_keyboard=function(){return i.asm.___em_js___api_close_keyboard.apply(null,arguments)},dv=i.___em_js___api_open_keyboard=function(){return i.asm.___em_js___api_open_keyboard.apply(null,arguments)},gv=i.___em_js__api_create_sound=function(){return i.asm.___em_js__api_create_sound.apply(null,arguments)},ny=i.___em_js__api_create_sound_float=function(){return i.asm.___em_js__api_create_sound_float.apply(null,arguments)},ty=i.___em_js__api_delete_sound=function(){return i.asm.___em_js__api_delete_sound.apply(null,arguments)},iy=i.___em_js__api_draw_begin=function(){return i.asm.___em_js__api_draw_begin.apply(null,arguments)},ry=i.___em_js__api_draw_belt=function(){return i.asm.___em_js__api_draw_belt.apply(null,arguments)},uy=i.___em_js__api_draw_blit=function(){return i.asm.___em_js__api_draw_blit.apply(null,arguments)},fy=i.___em_js__api_draw_clip_text=function(){return i.asm.___em_js__api_draw_clip_text.apply(null,arguments)},ey=i.___em_js__api_draw_end=function(){return i.asm.___em_js__api_draw_end.apply(null,arguments)},oy=i.___em_js__api_draw_text=function(){return i.asm.___em_js__api_draw_text.apply(null,arguments)},sy=i.___em_js__api_duplicate_sound=function(){return i.asm.___em_js__api_duplicate_sound.apply(null,arguments)},hy=i.___em_js__api_exit_game=function(){return i.asm.___em_js__api_exit_game.apply(null,arguments)},cy=i.___em_js__api_play_sound=function(){return i.asm.___em_js__api_play_sound.apply(null,arguments)},ly=i.___em_js__api_set_cursor=function(){return i.asm.___em_js__api_set_cursor.apply(null,arguments)},ay=i.___em_js__api_set_volume=function(){return i.asm.___em_js__api_set_volume.apply(null,arguments)},vy=i.___em_js__api_stop_sound=function(){return i.asm.___em_js__api_stop_sound.apply(null,arguments)},yy=i.___em_js__api_use_websocket=function(){return i.asm.___em_js__api_use_websocket.apply(null,arguments)},py=i.___em_js__api_websocket_closed=function(){return i.asm.___em_js__api_websocket_closed.apply(null,arguments)},wy=i.___em_js__api_websocket_send=function(){return i.asm.___em_js__api_websocket_send.apply(null,arguments)},by=i.___em_js__exit_error=function(){return i.asm.___em_js__exit_error.apply(null,arguments)},ky=i.___em_js__get_file_contents=function(){return i.asm.___em_js__get_file_contents.apply(null,arguments)},dy=i.___em_js__get_file_size=function(){return i.asm.___em_js__get_file_size.apply(null,arguments)},gy=i.___em_js__put_file_contents=function(){return i.asm.___em_js__put_file_contents.apply(null,arguments)},np=i.___em_js__remove_file=function(){return i.asm.___em_js__remove_file.apply(null,arguments)},tp=i.___em_js__show_alert=function(){return i.asm.___em_js__show_alert.apply(null,arguments)},ip=i.___em_js__trace_pop=function(){return i.asm.___em_js__trace_pop.apply(null,arguments)},rp=i.___em_js__trace_push=function(){return i.asm.___em_js__trace_push.apply(null,arguments)},up=i._emscripten_get_sbrk_ptr=function(){return i.asm._emscripten_get_sbrk_ptr.apply(null,arguments)},fp=i._emscripten_replace_memory=function(){return i.asm._emscripten_replace_memory.apply(null,arguments)},gh=i._free=function(){return i.asm._free.apply(null,arguments)},ep=i._llvm_bswap_i32=function(){return i.asm._llvm_bswap_i32.apply(null,arguments)},fi=i._malloc=function(){return i.asm._malloc.apply(null,arguments)},op=i._memcpy=function(){return i.asm._memcpy.apply(null,arguments)},sp=i._memmove=function(){return i.asm._memmove.apply(null,arguments)},hp=i._memset=function(){return i.asm._memset.apply(null,arguments)},o=i._setThrew=function(){return i.asm._setThrew.apply(null,arguments)},cp=i.establishStackSpace=function(){return i.asm.establishStackSpace.apply(null,arguments)},nc=i.globalCtors=function(){return i.asm.globalCtors.apply(null,arguments)},ei=i.stackAlloc=function(){return i.asm.stackAlloc.apply(null,arguments)},s=i.stackRestore=function(){return i.asm.stackRestore.apply(null,arguments)},h=i.stackSave=function(){return i.asm.stackSave.apply(null,arguments)},tc=i.dynCall_i=function(){return i.asm.dynCall_i.apply(null,arguments)},ic=i.dynCall_ii=function(){return i.asm.dynCall_ii.apply(null,arguments)},lp=i.dynCall_iidiiii=function(){return i.asm.dynCall_iidiiii.apply(null,arguments)},rc=i.dynCall_iii=function(){return i.asm.dynCall_iii.apply(null,arguments)},uc=i.dynCall_iiii=function(){return i.asm.dynCall_iiii.apply(null,arguments)},fc=i.dynCall_iiiii=function(){return i.asm.dynCall_iiiii.apply(null,arguments)},ec=i.dynCall_iiiiii=function(){return i.asm.dynCall_iiiiii.apply(null,arguments)},oc=i.dynCall_ji=function(){return i.asm.dynCall_ji.apply(null,arguments)},ap=i.dynCall_jiji=function(){return i.asm.dynCall_jiji.apply(null,arguments)},sc=i.dynCall_v=function(){return i.asm.dynCall_v.apply(null,arguments)},hc=i.dynCall_vi=function(){return i.asm.dynCall_vi.apply(null,arguments)},cc=i.dynCall_vii=function(){return i.asm.dynCall_vii.apply(null,arguments)},lc=i.dynCall_viii=function(){return i.asm.dynCall_viii.apply(null,arguments)},ac=i.dynCall_viiii=function(){return i.asm.dynCall_viiii.apply(null,arguments)},vc=i.dynCall_viiiii=function(){return i.asm.dynCall_viiiii.apply(null,arguments)},vp=i.dynCall_viiiiii=function(){return i.asm.dynCall_viiiiii.apply(null,arguments)},yc=i.dynCall_viiiiiii=function(){return i.asm.dynCall_viiiiiii.apply(null,arguments)},yp=i.dynCall_viiiiiiiii=function(){return i.asm.dynCall_viiiiiiiii.apply(null,arguments)},pp=i.dynCall_viiiiiiiiii=function(){return i.asm.dynCall_viiiiiiiiii.apply(null,arguments)},pc=i.dynCall_viij=function(){return i.asm.dynCall_viij.apply(null,arguments)},wc=i.dynCall_viji=function(){return i.asm.dynCall_viji.apply(null,arguments)};if(i.asm=wu,i.then=function(n){if(pt)n(i);else{var t=i.onRuntimeInitialized;i.onRuntimeInitialized=function(){t&&t();n(i)}}return i},bc=!1,vt=function kc(){pt||ur();pt||(vt=kc)},i.run=ur,i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return dt=!0,ur(),i.ready=new Promise(function(n,t){delete i.then;i.onAbort=function(n){t(n)};ru(function(){n(i)})}),t}}(),DiabloSpawn;typeof exports=="object"&&typeof module=="object"?module.exports=Diablo:typeof define=="function"&&define.amd?define([],function(){return Diablo}):typeof exports=="object"&&(exports.Diablo=Diablo);DiabloSpawn=function(){var n=typeof document!="undefined"&&document.currentScript?document.currentScript.src:undefined;return function(t){function ku(n){return i.locateFile?i.locateFile(n,a):a+n}function ai(n,t,r){return r&&r.length?i["dynCall_"+n].apply(null,[t].concat(r)):i["dynCall_"+n].call(null,t)}function b(n,t){n||c("Assertion failed: "+t)}function yr(n){var t=i["_"+n];return b(t,"Cannot call unknown function "+n+", make sure it is exported"),t}function ef(n,t,i,r){function a(n){return t==="string"?at(n):t==="boolean"?Boolean(n):n}var l={string:function(n){var t=0,i;return n!==null&&n!==undefined&&n!==0&&(i=(n.length<<2)+1,t=ei(i),wr(n,t,i)),t},array:function(n){var t=ei(n.length);return sf(n,t),t}},v=yr(n),o=[],f=0,u,c,e;if(r)for(u=0;u<r.length;u++)c=l[i[u]],c?(f===0&&(f=h()),o[u]=c(r[u])):o[u]=r[u];return e=v.apply(null,o),e=a(e),f!==0&&s(f),e}function pr(n,t,i){for(var h=t+i,u=t,f,r,e,o,s;n[u]&&!(u>=h);)++u;if(u-t>16&&n.subarray&&vi)return vi.decode(n.subarray(t,u));for(f="";t<u;){if(r=n[t++],!(r&128)){f+=String.fromCharCode(r);continue}if(e=n[t++]&63,(r&224)==192){f+=String.fromCharCode((r&31)<<6|e);continue}o=n[t++]&63;r=(r&240)==224?(r&15)<<12|e<<6|o:(r&7)<<18|e<<12|o<<6|n[t++]&63;r<65536?f+=String.fromCharCode(r):(s=r-65536,f+=String.fromCharCode(55296|s>>10,56320|s&1023))}return f}function at(n,t){return n?pr(u,n,t):""}function ni(n,t,i,r){var o,f,e,u,s;if(!(r>0))return 0;for(o=i,f=i+r-1,e=0;e<n.length;++e)if(u=n.charCodeAt(e),u>=55296&&u<=57343&&(s=n.charCodeAt(++e),u=65536+((u&1023)<<10)|s&1023),u<=127){if(i>=f)break;t[i++]=u}else if(u<=2047){if(i+1>=f)break;t[i++]=192|u>>6;t[i++]=128|u&63}else if(u<=65535){if(i+2>=f)break;t[i++]=224|u>>12;t[i++]=128|u>>6&63;t[i++]=128|u&63}else{if(i+3>=f)break;t[i++]=240|u>>18;t[i++]=128|u>>12&63;t[i++]=128|u>>6&63;t[i++]=128|u&63}return t[i]=0,i-o}function wr(n,t,i){return ni(n,u,t,i)}function sf(n,t){r.set(n,t)}function br(n,t){return n%t>0&&(n+=t-n%t),n}function kr(n){it=n;i.HEAP8=r=new Int8Array(n);i.HEAP16=d=new Int16Array(n);i.HEAP32=f=new Int32Array(n);i.HEAPU8=u=new Uint8Array(n);i.HEAPU16=cf=new Uint16Array(n);i.HEAPU32=lf=new Uint32Array(n);i.HEAPF32=ii=new Float32Array(n);i.HEAPF64=pi=new Float64Array(n)}function ri(n){for(var t,r;n.length>0;){if(t=n.shift(),typeof t=="function"){t();continue}r=t.func;typeof r=="number"?t.arg===undefined?i.dynCall_v(r):i.dynCall_vi(r,t.arg):r(t.arg===undefined?null:t.arg)}}function vf(){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)kf(i.preRun.shift());ri(gr)}function yf(){iu=!0;ri(bi)}function pf(){ri(nu)}function wf(){af=!0}function bf(){if(i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;)ru(i.postRun.shift());ri(tu)}function kf(n){gr.unshift(n)}function ru(n){tu.unshift(n)}function ie(){g++;i.monitorRunDependencies&&i.monitorRunDependencies(g)}function re(){if(g--,i.monitorRunDependencies&&i.monitorRunDependencies(g),g==0&&(ki!==null&&(clearInterval(ki),ki=null),vt)){var n=vt;vt=null;n()}}function c(n){if(i.onAbort)i.onAbort(n);n+="";ci(n);y(n);gt=!0;vr=1;throw"abort("+n+"). Build with -s ASSERTIONS=1 for more info.";}function uu(n){return String.prototype.startsWith?n.startsWith(di):n.indexOf(di)===0}function fu(){try{if(lt)return new Uint8Array(lt);if(st)return st(p);throw"both async and sync fetching of the wasm failed";}catch(n){c(n)}}function fe(){return!lt&&(ot||k)&&typeof fetch=="function"?fetch(p,{credentials:"same-origin"}).then(function(n){if(!n.ok)throw"failed to load wasm binary file at '"+p+"'";return n.arrayBuffer()}).catch(function(){return fu()}):new Promise(function(n){n(fu())})}function ee(){function r(n){var t=n.exports;i.asm=t;re("wasm-instantiate")}function t(n){r(n.instance)}function u(t){return fe().then(function(t){return WebAssembly.instantiate(t,n)}).then(t,function(n){y("failed to asynchronously prepare wasm: "+n);c(n)})}function f(){if(lt||typeof WebAssembly.instantiateStreaming!="function"||uu(p)||typeof fetch!="function")return u(t);fetch(p,{credentials:"same-origin"}).then(function(i){var r=WebAssembly.instantiateStreaming(i,n);return r.then(t,function(n){y("wasm streaming compile failed: "+n);y("falling back to ArrayBuffer instantiation");u(t)})})}var n={env:rr,wasi_unstable:rr,global:{NaN:NaN,Infinity:Infinity},"global.Math":Math,asm2wasm:tf};if(ie("wasm-instantiate"),i.instantiateWasm)try{return i.instantiateWasm(n,r)}catch(e){return y("Module.instantiateWasm callback failed with error: "+e),!1}return f(),{}}function oe(n,t){return eu[n](t)}function se(){self.DApi.close_keyboard()}function he(n,t,i,r,u){self.DApi.open_keyboard(n,t,i,r,u)}function ce(n,t,i){self.DApi.create_sound(n,u.slice(t,t+i))}function le(n,t,i,r,u){self.DApi.create_sound_raw(n,ii.slice(t/4,t/4+i*r),i,r,u)}function ae(n){self.DApi.delete_sound(n)}function ve(){self.DApi.draw_begin()}function ye(n){self.DApi.draw_belt(f.subarray(n/4,n/4+8))}function pe(n,t,i,r,f){self.DApi.draw_blit(n,t,i,r,u.subarray(f,f+i*r*4))}function we(n,t,i,r){self.DApi.draw_clip_text(n,t,i,r)}function be(){self.DApi.draw_end()}function ke(n,t,i,r){var f=u.indexOf(0,i),e=String.fromCharCode.apply(null,u.subarray(i,f));self.DApi.draw_text(n,t,e,r)}function de(n,t){self.DApi.duplicate_sound(n,t)}function ge(){self.DApi.exit_game()}function no(n,t,i,r){self.DApi.play_sound(n,t,i,r)}function to(n,t){self.DApi.set_cursor(n,t)}function io(n,t){self.DApi.set_volume(n,t)}function ro(n){self.DApi.stop_sound(n)}function uo(n){self.DApi.use_websocket(n)}function fo(){return self.DApi.websocket_closed()}function eo(n,t){self.DApi.websocket_send(u.subarray(n,n+t))}function oo(n){var t=u.indexOf(0,n),i=String.fromCharCode.apply(null,u.subarray(n,t));self.DApi.exit_error(i)}function so(n,t,i,r){var f=u.indexOf(0,n),e=String.fromCharCode.apply(null,u.subarray(n,f));self.DApi.get_file_contents(e,u.subarray(t,t+r),i)}function ho(n){var t=u.indexOf(0,n),i=String.fromCharCode.apply(null,u.subarray(n,t));return self.DApi.get_file_size(i)}function co(n,t,i){var r=u.indexOf(0,n),f=String.fromCharCode.apply(null,u.subarray(n,r));self.DApi.put_file_contents(f,u.slice(t,t+i))}function lo(n){var t=u.indexOf(0,n),i=String.fromCharCode.apply(null,u.subarray(n,t));self.DApi.remove_file(i)}function ao(n){var t=u.indexOf(0,n),i=String.fromCharCode.apply(null,u.subarray(n,t));self.alert(i)}function vo(){self.WASM_TRACE&&self.WASM_TRACE.pop()}function yo(n){var i=u.indexOf(0,n),t=String.fromCharCode.apply(null,u.subarray(n,i));console.log(t);self.WASM_TRACE=self.WASM_TRACE||[];self.WASM_TRACE.push(t)}function ou(n){return n}function su(n){return n.replace(/\b__Z[\w\d_]+/g,function(n){var t=ou(n);return n===t?n:t+" ["+n+"]"})}function hu(){var n=new Error;if(!n.stack){try{throw new Error(0);}catch(t){n=t}if(!n.stack)return"(no stack trace available)"}return n.stack.toString()}function po(){var n=hu();return i.extraStackTrace&&(n+="\n"+i.extraStackTrace()),su(n)}function wo(n,t,i,r){c("Assertion failed: "+at(n)+", at: "+[t?at(t):"unknown filename",i,r?at(r):"unknown function"])}function bo(n){return fi(n)}function cu(n){if(n){var t=v[n];t.refcount++}}function tr(n){var i,t;if(!n||v[n])return n;for(i in v){var r=+i,u=v[r].adjusted,f=u.length;for(t=0;t<f;t++)if(u[t]===n)return r}return n}function ko(n){var t=v[n];return t&&!t.caught&&(t.caught=!0,yt.uncaught_exceptions--),t&&(t.rethrown=!1),nr.push(n),cu(tr(n)),n}function lu(n){try{return gh(n)}catch(t){}}function au(n){if(n){var t=v[n];t.refcount--;t.refcount!==0||t.rethrown||(t.destructor&&i.dynCall_vi(t.destructor,n),delete v[n],lu(n))}}function go(){o(0);var n=nr.pop();n&&(au(tr(n)),ut=0)}function ns(n){ut||(ut=n);throw n;}function ui(){var n=ut,u,i,t;if(!n)return(ct(0),0)|0;if(u=v[n],i=u.type,!i)return(ct(0),n)|0;var r=Array.prototype.slice.call(arguments),o=dh(i),e=1850896;for(f[e>>2]=n,n=e,t=0;t<r.length;t++)if(r[t]&&kh(r[t],i,n))return n=f[n>>2],u.adjusted.push(n),(ct(r[t]),n)|0;return n=f[n>>2],(ct(i),n)|0}function ts(n,t){return ui(n,t)}function is(n,t,i){return ui(n,t,i)}function rs(n){return n}function us(){gt=!0;throw"Pure virtual function called!";}function fs(n,t,i){v[n]={ptr:n,adjusted:[n],type:t,destructor:i,refcount:0,caught:!1,rethrown:!1};ut=n;"uncaught_exception"in yt?yt.uncaught_exceptions++:yt.uncaught_exceptions=1;throw n;}function es(){return yt.uncaught_exceptions}function os(){}function ss(){}function hs(n,t){e.varargs=t;try{var r=e.getStreamFromFD(),u=e.get(),f=e.get(),o=e.get(),s=e.get();return 0}catch(i){return typeof FS!="undefined"&&i instanceof FS.ErrnoError||c(i),-i.errno}}function cs(n,t){e.varargs=t;try{var r=e.getStreamFromFD();return 0}catch(i){return typeof FS!="undefined"&&i instanceof FS.ErrnoError||c(i),-i.errno}}function ls(){}function as(){var t=i._fflush,n;t&&t(0);n=e.buffers;n[1].length&&e.printChar(1,10);n[2].length&&e.printChar(2,10)}function vu(n,t,i,r){var h,o,v,l,s;try{for(h=0,o=0;o<i;o++){for(v=f[t+o*8>>2],l=f[t+(o*8+4)>>2],s=0;s<l;s++)e.printChar(n,u[v+s]);h+=l}return f[r>>2]=h,0}catch(a){return typeof FS!="undefined"&&a instanceof FS.ErrnoError||c(a),-a.errno}}function vs(){return vu.apply(null,arguments)}function ys(){c()}function ir(){return r.length}function ws(){c("OOM")}function yu(n){try{return tt.grow(n-it.byteLength+65535>>16),kr(tt.buffer),1}catch(t){}}function bs(n){var e=ir(),i=65536,r=2147483648-i,u,t,f;if(n>r)return!1;for(u=16777216,t=Math.max(e,u);t<n;)t=t<=536870912?br(2*t,i):Math.min(br((3*t+2147483648)/4,i),r);return(f=yu(t),!f)?!1:!0}function ks(n){dc(n)}function ds(n){return n}function gs(){c("trap!")}function nh(n,t,i){u.set(u.subarray(t,t+i),n)}function th(n){var t=Date.now()/1e3|0;return n&&(f[n>>2]=t),t}function ih(n){var i=h();try{return tc(n)}catch(t){if(s(i),t!==t+0&&t!=="longjmp")throw t;o(1,0)}}function rh(n,t){var r=h();try{return ic(n,t)}catch(i){if(s(r),i!==i+0&&i!=="longjmp")throw i;o(1,0)}}function uh(n,t,i){var u=h();try{return rc(n,t,i)}catch(r){if(s(u),r!==r+0&&r!=="longjmp")throw r;o(1,0)}}function fh(n,t,i,r){var f=h();try{return uc(n,t,i,r)}catch(u){if(s(f),u!==u+0&&u!=="longjmp")throw u;o(1,0)}}function eh(n,t,i,r,u){var e=h();try{return fc(n,t,i,r,u)}catch(f){if(s(e),f!==f+0&&f!=="longjmp")throw f;o(1,0)}}function oh(n,t,i,r,u,f){var c=h();try{return ec(n,t,i,r,u,f)}catch(e){if(s(c),e!==e+0&&e!=="longjmp")throw e;o(1,0)}}function sh(n,t){var r=h();try{return oc(n,t)}catch(i){if(s(r),i!==i+0&&i!=="longjmp")throw i;o(1,0)}}function hh(n){var i=h();try{sc(n)}catch(t){if(s(i),t!==t+0&&t!=="longjmp")throw t;o(1,0)}}function ch(n,t){var r=h();try{hc(n,t)}catch(i){if(s(r),i!==i+0&&i!=="longjmp")throw i;o(1,0)}}function lh(n,t,i){var u=h();try{cc(n,t,i)}catch(r){if(s(u),r!==r+0&&r!=="longjmp")throw r;o(1,0)}}function ah(n,t,i,r){var f=h();try{lc(n,t,i,r)}catch(u){if(s(f),u!==u+0&&u!=="longjmp")throw u;o(1,0)}}function vh(n,t,i,r,u){var e=h();try{ac(n,t,i,r,u)}catch(f){if(s(e),f!==f+0&&f!=="longjmp")throw f;o(1,0)}}function yh(n,t,i,r,u,f){var c=h();try{vc(n,t,i,r,u,f)}catch(e){if(s(c),e!==e+0&&e!=="longjmp")throw e;o(1,0)}}function ph(n,t,i,r,u,f,e,c){var a=h();try{yc(n,t,i,r,u,f,e,c)}catch(l){if(s(a),l!==l+0&&l!=="longjmp")throw l;o(1,0)}}function wh(n,t,i,r,u){var e=h();try{pc(n,t,i,r,u)}catch(f){if(s(e),f!==f+0&&f!=="longjmp")throw f;o(1,0)}}function bh(n,t,i,r,u){var e=h();try{wc(n,t,i,r,u)}catch(f){if(s(e),f!==f+0&&f!=="longjmp")throw f;o(1,0)}}function bu(n){this.name="ExitStatus";this.message="Program terminated with exit("+n+")";this.status=n}function ur(n){function t(){pt||(pt=!0,gt)||(yf(),pf(),i.onRuntimeInitialized&&i.onRuntimeInitialized(),bf())}(n=n||et,g>0)||(vf(),g>0)||(i.setStatus?(i.setStatus("Running..."),setTimeout(function(){setTimeout(function(){i.setStatus("")},1);t()},1)):t())}function dc(n,t){if(!t||!dt||n!==0){if(!dt&&(gt=!0,vr=n,wf(),i.onExit))i.onExit(n);wt(n,new bu(n))}}var i,nt,w,a,bt,du,st,gu,si,hi,ci,y,sr,kt,dt,vi,yi,it,r,u,d,cf,f,lf,ii,pi,ue,di,p,rt,gi,eu,l,v,nr,ut,ft,e,ps,pu,pt,bc;t=t||{};i=typeof t!="undefined"?t:{};nt={};for(w in i)i.hasOwnProperty(w)&&(nt[w]=i[w]);var et=[],fr="./this.program",wt=function(n,t){throw t;},ot=!1,k=!1,oi=!1,er=!1,or=!1;if(ot=typeof window=="object",k=typeof importScripts=="function",er=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",oi=er&&!ot&&!k,or=!ot&&!oi&&!k,a="",oi){a=__dirname+"/";bt=function(n,t){var i;return si||(si=require("fs")),hi||(hi=require("path")),n=hi.normalize(n),i=si.readFileSync(n),t?i:i.toString()};st=function(n){var t=bt(n,!0);return t.buffer||(t=new Uint8Array(t)),b(t.buffer),t};process.argv.length>1&&(fr=process.argv[1].replace(/\\/g,"/"));et=process.argv.slice(2);process.on("uncaughtException",function(n){if(!(n instanceof bu))throw n;});process.on("unhandledRejection",c);wt=function(n){process.exit(n)};i.inspect=function(){return"[Emscripten Module object]"}}else or?(typeof read!="undefined"&&(bt=function(n){return read(n)}),st=function(n){var t;return typeof readbuffer=="function"?new Uint8Array(readbuffer(n)):(t=read(n,"binary"),b(typeof t=="object"),t)},typeof scriptArgs!="undefined"?et=scriptArgs:typeof arguments!="undefined"&&(et=arguments),typeof quit=="function"&&(wt=function(n){quit(n)}),typeof print!="undefined"&&(typeof console=="undefined"&&(console={}),console.log=print,console.warn=console.error=typeof printErr!="undefined"?printErr:print)):(ot||k)&&(k?a=self.location.href:document.currentScript&&(a=document.currentScript.src),n&&(a=n),a=a.indexOf("blob:")!==0?a.substr(0,a.lastIndexOf("/")+1):"",bt=function(n){var t=new XMLHttpRequest;return t.open("GET",n,!1),t.send(null),t.responseText},k&&(st=function(n){var t=new XMLHttpRequest;return t.open("GET",n,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),du=function(n,t,i){var r=new XMLHttpRequest;r.open("GET",n,!0);r.responseType="arraybuffer";r.onload=function(){if(r.status==200||r.status==0&&r.response){t(r.response);return}i()};r.onerror=i;r.send(null)},gu=function(n){document.title=n});ci=i.print||console.log.bind(console);y=i.printErr||console.warn.bind(console);for(w in nt)nt.hasOwnProperty(w)&&(i[w]=nt[w]);nt=null;i.arguments&&(et=i.arguments);i.thisProgram&&(fr=i.thisProgram);i.quit&&(wt=i.quit);sr=16;var tf={"f64-rem":function(n,t){return n%t},"debugger":function(){}},cr=1,li=new Array(0);kt={};var lr=0,ct=function(n){lr=n},uf=function(){return lr},lt;i.wasmBinary&&(lt=i.wasmBinary);i.noExitRuntime&&(dt=i.noExitRuntime);typeof WebAssembly!="object"&&y("no native wasm support detected");var tt,ar=new WebAssembly.Table({initial:1118,maximum:1118,element:"anyfunc"}),gt=!1,vr=0;var of=3;vi=typeof TextDecoder!="undefined"?new TextDecoder("utf8"):undefined;yi=typeof TextDecoder!="undefined"?new TextDecoder("utf-16le"):undefined;var wi=1850704,dr=i.TOTAL_MEMORY||134217728;tt=i.wasmMemory?i.wasmMemory:new WebAssembly.Memory({initial:dr/65536});tt&&(it=tt.buffer);dr=it.byteLength;kr(it);f[wi>>2]=7093808;var gr=[],bi=[],nu=[],tu=[],iu=!1,af=!1;var df=Math.abs,oa=Math.cos,sa=Math.sin,ha=Math.tan,ca=Math.acos,la=Math.asin,aa=Math.atan,va=Math.atan2,ya=Math.exp,pa=Math.log,wa=Math.sqrt,gf=Math.ceil,ne=Math.floor,ba=Math.pow,ka=Math.imul,da=Math.fround,ga=Math.round,te=Math.min,nv=Math.max,tv=Math.clz32,iv=Math.trunc,g=0,ki=null,vt=null;i.preloadedImages={};i.preloadedAudios={};ue=null;di="data:application/octet-stream;base64,";p="DiabloSpawn.wasm";uu(p)||(p=ku(p));i.asm=ee;eu=[function(n){self.DApi.current_save_id(n)}];bi.push({func:function(){nc()}});l=1850912;v={};nr=[];ut=0;i.___cxa_find_matching_catch=ui;ft={splitPath:function(n){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(n).slice(1)},normalizeArray:function(n,t){for(var u,r=0,i=n.length-1;i>=0;i--)u=n[i],u==="."?n.splice(i,1):u===".."?(n.splice(i,1),r++):r&&(n.splice(i,1),r--);if(t)for(;r;r--)n.unshift("..");return n},normalize:function(n){var t=n.charAt(0)==="/",i=n.substr(-1)==="/";return n=ft.normalizeArray(n.split("/").filter(function(n){return!!n}),!t).join("/"),n||t||(n="."),n&&i&&(n+="/"),(t?"/":"")+n},dirname:function(n){var i=ft.splitPath(n),r=i[0],t=i[1];return!r&&!t?".":(t&&(t=t.substr(0,t.length-1)),r+t)},basename:function(n){if(n==="/")return"/";var t=n.lastIndexOf("/");return t===-1?n:n.substr(t+1)},extname:function(n){return ft.splitPath(n)[3]},join:function(){var n=Array.prototype.slice.call(arguments,0);return ft.normalize(n.join("/"))},join2:function(n,t){return ft.normalize(n+"/"+t)}};e={buffers:[null,[],[]],printChar:function(n,t){var i=e.buffers[n];t===0||t===10?((n===1?ci:y)(pr(i,0)),i.length=0):i.push(t)},varargs:0,get:function(){e.varargs+=4;return f[e.varargs-4>>2]},getStr:function(){return at(e.get())},get64:function(){var n=e.get(),t=e.get();return n},getZero:function(){e.get()}};ps=!0;pu=!1;var rr={___assert_fail:wo,___cxa_allocate_exception:bo,___cxa_begin_catch:ko,___cxa_end_catch:go,___cxa_find_matching_catch:ui,___cxa_find_matching_catch_2:ts,___cxa_find_matching_catch_3:is,___cxa_free_exception:lu,___cxa_get_exception_ptr:rs,___cxa_pure_virtual:us,___cxa_throw:fs,___cxa_uncaught_exceptions:es,___exception_addRef:cu,___exception_deAdjust:tr,___exception_decRef:au,___gxx_personality_v0:os,___lock:ss,___resumeException:ns,___syscall140:hs,___syscall6:cs,___unlock:ls,___wasi_fd_write:vs,__api_close_keyboard:se,__api_open_keyboard:he,__memory_base:1024,__table_base:0,_abort:ys,_api_create_sound:ce,_api_create_sound_float:le,_api_delete_sound:ae,_api_draw_begin:ve,_api_draw_belt:ye,_api_draw_blit:pe,_api_draw_clip_text:we,_api_draw_end:be,_api_draw_text:ke,_api_duplicate_sound:de,_api_exit_game:ge,_api_play_sound:no,_api_set_cursor:to,_api_set_volume:io,_api_stop_sound:ro,_api_use_websocket:uo,_api_websocket_closed:fo,_api_websocket_send:eo,_emscripten_asm_const_ii:oe,_emscripten_get_heap_size:ir,_emscripten_memcpy_big:nh,_emscripten_resize_heap:bs,_exit:ks,_exit_error:oo,_fd_write:vu,_get_file_contents:so,_get_file_size:ho,_llvm_eh_typeid_for:ds,_llvm_trap:gs,_put_file_contents:co,_remove_file:lo,_show_alert:ao,_time:th,_trace_pop:vo,_trace_push:yo,abort:c,abortOnCannotGrowMemory:ws,demangle:ou,demangleAll:su,emscripten_realloc_buffer:yu,flush_NO_FILESYSTEM:as,getTempRet0:uf,invoke_i:ih,invoke_ii:rh,invoke_iii:uh,invoke_iiii:fh,invoke_iiiii:eh,invoke_iiiiii:oh,invoke_ji:sh,invoke_v:hh,invoke_vi:ch,invoke_vii:lh,invoke_viii:ah,invoke_viiii:vh,invoke_viiiii:yh,invoke_viiiiiii:ph,invoke_viij:wh,invoke_viji:bh,jsStackTrace:hu,memory:tt,setTempRet0:ct,stackTrace:po,table:ar,tempDoublePtr:l},wu=i.asm({},rr,it);i.asm=wu;var sv=i._DApi_AllocPacket=function(){return i.asm._DApi_AllocPacket.apply(null,arguments)},hv=i._DApi_Char=function(){return i.asm._DApi_Char.apply(null,arguments)},cv=i._DApi_Init=function(){return i.asm._DApi_Init.apply(null,arguments)},lv=i._DApi_Key=function(){return i.asm._DApi_Key.apply(null,arguments)},av=i._DApi_Mouse=function(){return i.asm._DApi_Mouse.apply(null,arguments)},vv=i._DApi_Render=function(){return i.asm._DApi_Render.apply(null,arguments)},yv=i._DApi_SyncText=function(){return i.asm._DApi_SyncText.apply(null,arguments)},pv=i._DApi_SyncTextPtr=function(){return i.asm._DApi_SyncTextPtr.apply(null,arguments)},wv=i._SNet_InitWebsocket=function(){return i.asm._SNet_InitWebsocket.apply(null,arguments)},bv=i._SNet_WebsocketStatus=function(){return i.asm._SNet_WebsocketStatus.apply(null,arguments)},yt=i.__ZSt18uncaught_exceptionv=function(){return i.asm.__ZSt18uncaught_exceptionv.apply(null,arguments)},kh=i.___cxa_can_catch=function(){return i.asm.___cxa_can_catch.apply(null,arguments)},dh=i.___cxa_is_pointer_type=function(){return i.asm.___cxa_is_pointer_type.apply(null,arguments)},kv=i.___em_js___api_close_keyboard=function(){return i.asm.___em_js___api_close_keyboard.apply(null,arguments)},dv=i.___em_js___api_open_keyboard=function(){return i.asm.___em_js___api_open_keyboard.apply(null,arguments)},gv=i.___em_js__api_create_sound=function(){return i.asm.___em_js__api_create_sound.apply(null,arguments)},ny=i.___em_js__api_create_sound_float=function(){return i.asm.___em_js__api_create_sound_float.apply(null,arguments)},ty=i.___em_js__api_delete_sound=function(){return i.asm.___em_js__api_delete_sound.apply(null,arguments)},iy=i.___em_js__api_draw_begin=function(){return i.asm.___em_js__api_draw_begin.apply(null,arguments)},ry=i.___em_js__api_draw_belt=function(){return i.asm.___em_js__api_draw_belt.apply(null,arguments)},uy=i.___em_js__api_draw_blit=function(){return i.asm.___em_js__api_draw_blit.apply(null,arguments)},fy=i.___em_js__api_draw_clip_text=function(){return i.asm.___em_js__api_draw_clip_text.apply(null,arguments)},ey=i.___em_js__api_draw_end=function(){return i.asm.___em_js__api_draw_end.apply(null,arguments)},oy=i.___em_js__api_draw_text=function(){return i.asm.___em_js__api_draw_text.apply(null,arguments)},sy=i.___em_js__api_duplicate_sound=function(){return i.asm.___em_js__api_duplicate_sound.apply(null,arguments)},hy=i.___em_js__api_exit_game=function(){return i.asm.___em_js__api_exit_game.apply(null,arguments)},cy=i.___em_js__api_play_sound=function(){return i.asm.___em_js__api_play_sound.apply(null,arguments)},ly=i.___em_js__api_set_cursor=function(){return i.asm.___em_js__api_set_cursor.apply(null,arguments)},ay=i.___em_js__api_set_volume=function(){return i.asm.___em_js__api_set_volume.apply(null,arguments)},vy=i.___em_js__api_stop_sound=function(){return i.asm.___em_js__api_stop_sound.apply(null,arguments)},yy=i.___em_js__api_use_websocket=function(){return i.asm.___em_js__api_use_websocket.apply(null,arguments)},py=i.___em_js__api_websocket_closed=function(){return i.asm.___em_js__api_websocket_closed.apply(null,arguments)},wy=i.___em_js__api_websocket_send=function(){return i.asm.___em_js__api_websocket_send.apply(null,arguments)},by=i.___em_js__exit_error=function(){return i.asm.___em_js__exit_error.apply(null,arguments)},ky=i.___em_js__get_file_contents=function(){return i.asm.___em_js__get_file_contents.apply(null,arguments)},dy=i.___em_js__get_file_size=function(){return i.asm.___em_js__get_file_size.apply(null,arguments)},gy=i.___em_js__put_file_contents=function(){return i.asm.___em_js__put_file_contents.apply(null,arguments)},np=i.___em_js__remove_file=function(){return i.asm.___em_js__remove_file.apply(null,arguments)},tp=i.___em_js__show_alert=function(){return i.asm.___em_js__show_alert.apply(null,arguments)},ip=i.___em_js__trace_pop=function(){return i.asm.___em_js__trace_pop.apply(null,arguments)},rp=i.___em_js__trace_push=function(){return i.asm.___em_js__trace_push.apply(null,arguments)},up=i._emscripten_get_sbrk_ptr=function(){return i.asm._emscripten_get_sbrk_ptr.apply(null,arguments)},fp=i._emscripten_replace_memory=function(){return i.asm._emscripten_replace_memory.apply(null,arguments)},gh=i._free=function(){return i.asm._free.apply(null,arguments)},ep=i._llvm_bswap_i32=function(){return i.asm._llvm_bswap_i32.apply(null,arguments)},fi=i._malloc=function(){return i.asm._malloc.apply(null,arguments)},op=i._memcpy=function(){return i.asm._memcpy.apply(null,arguments)},sp=i._memmove=function(){return i.asm._memmove.apply(null,arguments)},hp=i._memset=function(){return i.asm._memset.apply(null,arguments)},o=i._setThrew=function(){return i.asm._setThrew.apply(null,arguments)},cp=i.establishStackSpace=function(){return i.asm.establishStackSpace.apply(null,arguments)},nc=i.globalCtors=function(){return i.asm.globalCtors.apply(null,arguments)},ei=i.stackAlloc=function(){return i.asm.stackAlloc.apply(null,arguments)},s=i.stackRestore=function(){return i.asm.stackRestore.apply(null,arguments)},h=i.stackSave=function(){return i.asm.stackSave.apply(null,arguments)},tc=i.dynCall_i=function(){return i.asm.dynCall_i.apply(null,arguments)},ic=i.dynCall_ii=function(){return i.asm.dynCall_ii.apply(null,arguments)},lp=i.dynCall_iidiiii=function(){return i.asm.dynCall_iidiiii.apply(null,arguments)},rc=i.dynCall_iii=function(){return i.asm.dynCall_iii.apply(null,arguments)},uc=i.dynCall_iiii=function(){return i.asm.dynCall_iiii.apply(null,arguments)},fc=i.dynCall_iiiii=function(){return i.asm.dynCall_iiiii.apply(null,arguments)},ec=i.dynCall_iiiiii=function(){return i.asm.dynCall_iiiiii.apply(null,arguments)},oc=i.dynCall_ji=function(){return i.asm.dynCall_ji.apply(null,arguments)},ap=i.dynCall_jiji=function(){return i.asm.dynCall_jiji.apply(null,arguments)},sc=i.dynCall_v=function(){return i.asm.dynCall_v.apply(null,arguments)},hc=i.dynCall_vi=function(){return i.asm.dynCall_vi.apply(null,arguments)},cc=i.dynCall_vii=function(){return i.asm.dynCall_vii.apply(null,arguments)},lc=i.dynCall_viii=function(){return i.asm.dynCall_viii.apply(null,arguments)},ac=i.dynCall_viiii=function(){return i.asm.dynCall_viiii.apply(null,arguments)},vc=i.dynCall_viiiii=function(){return i.asm.dynCall_viiiii.apply(null,arguments)},vp=i.dynCall_viiiiii=function(){return i.asm.dynCall_viiiiii.apply(null,arguments)},yc=i.dynCall_viiiiiii=function(){return i.asm.dynCall_viiiiiii.apply(null,arguments)},yp=i.dynCall_viiiiiiiii=function(){return i.asm.dynCall_viiiiiiiii.apply(null,arguments)},pp=i.dynCall_viiiiiiiiii=function(){return i.asm.dynCall_viiiiiiiiii.apply(null,arguments)},pc=i.dynCall_viij=function(){return i.asm.dynCall_viij.apply(null,arguments)},wc=i.dynCall_viji=function(){return i.asm.dynCall_viji.apply(null,arguments)};if(i.asm=wu,i.then=function(n){if(pt)n(i);else{var t=i.onRuntimeInitialized;i.onRuntimeInitialized=function(){t&&t();n(i)}}return i},bc=!1,vt=function kc(){pt||ur();pt||(vt=kc)},i.run=ur,i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return dt=!0,ur(),i.ready=new Promise(function(n,t){delete i.then;i.onAbort=function(n){t(n)};ru(function(){n(i)})}),t}}();typeof exports=="object"&&typeof module=="object"?module.exports=DiabloSpawn:typeof define=="function"&&define.amd?define([],function(){return DiabloSpawn}):typeof exports=="object"&&(exports.DiabloSpawn=DiabloSpawn);class Helper{}Helper.fromUint8ArrayToBase64=n=>base64js.fromByteArray(n);Helper.onError=(n,t="error")=>{n instanceof Error?alert(`Action: ${t} Error: ${n.toString()} Stack: ${n.stack}`):alert(`Action: ${t} Error: ${n.toString()}`)};Helper.tryApi=n=>{try{n()}catch(t){Helper.onError(t)}};class Graphics{constructor(){this.initGraphics=n=>{const t=document.getElementById("canvas");this.context=n?t.getContext("bitmaprenderer"):t.getContext("2d",{alpha:!1})};this.drawBegin=()=>{this.renderBatch={images:[],text:[],clip:null}};this.drawEnd=()=>{this.onRender(),this.renderBatch=null};this.drawBlit=(n,t,i,r,u)=>{this.renderBatch.images.push({x:n,y:t,width:i,height:r,data:u.slice()})};this.drawClipText=(n,t,i,r)=>{this.renderBatch.clip={x0:n,y0:t,x1:i,y1:r}};this.drawText=(n,t,i,r)=>{this.renderBatch.text.push({x:n,y:t,text:i,color:r})};this.drawBelt=()=>{};this.onRender=()=>{if(this.context instanceof ImageBitmapRenderingContext)this.context.transferFromImageBitmap(this.renderBatch.bitmap);else if(this.context instanceof CanvasRenderingContext2D){const n=this.context;for(let t of this.renderBatch.images){const i=n.createImageData(t.width,t.height);i.data.set(t.data);n.putImageData(i,t.x,t.y)}if(this.renderBatch.text.length){if(n.save(),n.font="bold 13px Times New Roman",this.renderBatch.clip){const t=this.renderBatch.clip;n.beginPath();n.rect(t.x0,t.y0,t.x1-t.x0,t.y1-t.y0);n.clip()}for(let t of this.renderBatch.text){const i=t.color>>16&255,r=t.color>>8&255,u=t.color&255;n.fillStyle=`rgb(${i}, ${r}, ${u})`;n.fillText(t.text,t.x,t.y)}n.restore()}}};windowAny.DApi.draw_begin=this.drawBegin;windowAny.DApi.draw_end=this.drawEnd;windowAny.DApi.draw_blit=this.drawBlit;windowAny.DApi.draw_clip_text=this.drawClipText;windowAny.DApi.draw_text=this.drawText;windowAny.DApi.draw_belt=this.drawBelt}}class Sound{constructor(){this.initSound=()=>{const n=window.AudioContext||windowAny.webkitAudioContext;if(n){this.context=null;try{this.context=new n}catch(t){}this.sounds=new Map}};this.createSound=(n,t)=>{if(this.context){const i=this.decodeAudioData(this.context,t.buffer);this.sounds.set(n,{buffer:i,gain:this.context.createGain(),panner:StereoPannerNode&&new StereoPannerNode(this.context,{pan:0})})}};this.createSoundRaw=(n,t,i,r,u)=>{if(this.context){const f=this.context.createBuffer(r,i,u);for(let n=0;n<r;++n)f.getChannelData(n).set(t.subarray(n*i,n*i+i));this.sounds.set(n,{buffer:Promise.resolve(f),gain:this.context.createGain(),panner:StereoPannerNode&&new StereoPannerNode(this.context,{pan:0})})}};this.duplicateSound=(n,t)=>{if(this.context){const i=this.sounds.get(t);i&&this.sounds.set(n,{buffer:i.buffer,gain:this.context.createGain(),panner:StereoPannerNode&&new StereoPannerNode(this.context,{pan:0})})}};this.playSound=(n,t,i,r)=>{const u=this.sounds.get(n);if(u){u.source&&u.source.then(n=>n.stop());u.gain.gain.value=Math.pow(2,t/1e3);const n=Math.pow(2,i/1e3);u.panner&&(u.panner.pan.value=1-2/(1+n));u.source=u.buffer.then(n=>{const t=this.context.createBufferSource();t.buffer=n;t.loop=!!r;let i=t.connect(u.gain);return u.panner&&(i=i.connect(u.panner)),i.connect(this.context.destination),t.start(),t})}};this.stopSound=n=>{const t=this.sounds.get(n);t&&t.source&&(t.source.then(n=>n.stop()),delete t.source)};this.deleteSound=n=>{const t=this.sounds.get(n);t&&t.source&&t.source.then(n=>n.stop());this.sounds.delete(n)};this.setVolume=(n,t)=>{const i=this.sounds.get(n);i&&(i.gain.gain.value=Math.pow(2,t/1e3))};this.decodeAudioData=(n,t)=>new Promise((i,r)=>{n.decodeAudioData(t,i,r)});windowAny.DApi.create_sound=this.createSound;windowAny.DApi.create_sound_raw=this.createSoundRaw;windowAny.DApi.play_sound=this.playSound;windowAny.DApi.stop_sound=this.stopSound;windowAny.DApi.delete_sound=this.deleteSound;windowAny.DApi.duplicate_sound=this.duplicateSound;windowAny.DApi.set_volume=this.setVolume}}class Progress{constructor(n,t,i){this.message=n;this.bytesLoaded=t;this.total=i}}class Webassembly{constructor(){this.initWebAssemblyUnmarshalledBegin=async(n,t,i)=>{const r=windowAny.Module.HEAPU8.subarray(t,t+i);this.wasm=await(n?DiabloSpawn:Diablo)({wasmBinary:r}).ready;getInterop().dotNetReference.invokeMethodAsync("InitWebAssemblyUnmarshalledEnd")};this.dapiInit=(n,t,i,r,u)=>{this.wasm&&this.wasm._DApi_Init(n,t,i,r,u)};this.dapiMouse=(n,t,i,r,u)=>{this.wasm&&this.wasm._DApi_Mouse(n,t,i,r,u)};this.dapiKey=(n,t,i)=>{this.wasm&&this.wasm._DApi_Key(n,t,i)};this.dapiChar=n=>{this.wasm&&this.wasm._DApi_Char(n)};this.callApi=(n,...t)=>{this.wasm&&Helper.tryApi(()=>{if(n!=="text")this.wasm["_"+n](...t);else{const n=this.wasm._DApi_SyncTextPtr(),i=t[0],r=Math.min(i.length,255),u=this.wasm.HEAPU8;for(let t=0;t<r;++t)u[n+t]=i.charCodeAt(t);u[n+r]=0;this.wasm._DApi_SyncText(t[1])}})}}}class FileStore{constructor(){this.initIndexedDb=async()=>{this.store=new IdbKvStore("diablo_fs");for(let[n,t]of Object.entries(await this.store.json()))this.files.set(n.toLowerCase(),t)};this.updateIndexedDbFromUint8Array=async(n,t)=>{await this.store.set(n,t)};this.readIndexedDb=async n=>{const t=await this.store.get(n.toLowerCase());return Helper.fromUint8ArrayToBase64(t)};this.indexedDbHasFile=async n=>{const t=await this.store.get(n.toLowerCase());return t?!0:!1};this.storeSpawnUnmarshalledBegin=async(n,t)=>{const u=windowAny.Module.HEAPU8.subarray(n,n+t),i=new Uint8Array(u),r="spawn.mpq";await this.store.set(r,i);this.files.set(r,i);getInterop().dotNetReference.invokeMethodAsync("StoreSpawnUnmarshalledEnd")};this.readFile=n=>new Promise((t,i)=>{const r=new FileReader;r.onload=()=>t(r.result);r.onerror=()=>i(r.error);r.onabort=()=>i();r.onprogress=n=>getInterop().dotNetReference.invokeMethodAsync("OnProgress",new Progress("Loading...",n.loaded,n.total));r.readAsArrayBuffer(n)});this.getFileFromInput=async n=>{const i=document.getElementById(n),t=i.files[0],r=t.name.toLowerCase(),u=new Uint8Array(await this.readFile(t));return{name:r,data:u}};this.isDropFile=n=>{const t=n.dataTransfer.items;if(t)for(let n=0;n<t.length;++n)if(t[n].kind==="file")return!0;return n.dataTransfer.files.length?!0:!1};this.onDropFile=n=>{this.dropFile=this.getDropFile(n),this.dropFile&&(n.preventDefault(),getInterop().dotNetReference.invokeMethodAsync("Start",this.dropFile.name.toLowerCase(),!0))};this.getDropFile=n=>{const t=n.dataTransfer.items;if(t)for(let n=0;n<t.length;++n)if(t[n].kind==="file")return t[n].getAsFile();const i=n.dataTransfer.files;if(i.length)return i[0]};this.setDropFile=async()=>{const n=new Uint8Array(await this.readFile(this.dropFile));this.files.set(this.dropFile.name.toLowerCase(),n);this.dropFile=null};this.setInputFile=async()=>{const n=await this.getFileFromInput("mpqInput");this.files.set(n.name,n.data)};this.uploadFile=async()=>{const n=await this.getFileFromInput("saveInput");this.files.set(n.name,n.data);this.store.set(n.name,n.data)};this.hasFile=(n,t)=>{const i=this.files.get(n.toLowerCase());return i?t.length>0?t.includes(i.byteLength):!0:!1};this.getFilenames=()=>[...this.files.keys()];this.getFilesize=n=>{const t=this.files.get(n.toLowerCase());return t?t.byteLength:0};this.getFileContents=(n,t,i)=>{const r=this.files.get(n.toLowerCase());r&&t.set(r.subarray(i,i+t.byteLength))};this.putFileContents=async(n,t)=>{n=n.toLowerCase(),this.files.set(n,t),await this.updateIndexedDbFromUint8Array(n,t)};this.removeFile=async n=>{n=n.toLowerCase(),this.files.delete(n),await this.store.remove(n)};this.getRenderInterval=()=>{const n=localStorage.getItem("DiabloRenderInterval");return n?parseInt(n):50};this.setRenderInterval=n=>{localStorage.setItem("DiabloRenderInterval",n.toString())};this.files=new Map;windowAny.DApi.get_file_size=this.getFilesize;windowAny.DApi.get_file_contents=this.getFileContents;windowAny.DApi.put_file_contents=this.putFileContents;windowAny.DApi.remove_file=this.removeFile}}class Interop{constructor(){this.setDotNetReference=n=>{this._dotNetReference=n};this.addEventListeners=()=>{window.addEventListener("resize",()=>this._dotNetReference.invokeMethodAsync("OnResize",this.getCanvasRect()));const n=document.getElementById("main");n.addEventListener("drop",n=>this._fileStore.onDropFile(n));n.addEventListener("dragover",n=>{this._fileStore.isDropFile(n)&&n.preventDefault()});this.canvas.addEventListener("keydown",n=>{(n.keyCode===8||n.keyCode===9||n.keyCode>=112&&n.keyCode<=119)&&n.preventDefault()});this.canvas.addEventListener("contextmenu",n=>n.preventDefault())};this.getCanvasRect=()=>this.canvas.getBoundingClientRect();this.openKeyboard=()=>{};this.closeKeyboard=()=>{};this.exitError=n=>{throw Error(n);};this.exitGame=()=>{this._dotNetReference.invokeMethodAsync("OnExit")};this.currentSaveId=n=>{this._dotNetReference.invokeMethodAsync("SetSaveName",n)};this.setCursor=(n,t)=>{this._webassembly.dapiMouse(0,0,0,n,t)};this.reload=()=>{window.location.reload()};this.clickDownloadLink=(n,t,i)=>{n.setAttribute("download",t),n.setAttribute("href",i),n.click(),n.removeAttribute("download"),n.removeAttribute("href")};this._webassembly=new Webassembly;this._graphics=new Graphics;this._sound=new Sound;this._fileStore=new FileStore;windowAny.DApi.open_keyboard=this.openKeyboard;windowAny.DApi.close_keyboard=this.closeKeyboard;windowAny.DApi.set_cursor=this.setCursor;windowAny.DApi.current_save_id=this.currentSaveId;windowAny.DApi.exit_game=this.exitGame;windowAny.DApi.exit_error=this.exitError}get webassembly(){return this._webassembly}get graphics(){return this._graphics}get sound(){return this._sound}get fileStore(){return this._fileStore}get canvas(){return this._canvas||(this._canvas=document.getElementById("canvas")),this._canvas}get dotNetReference(){return this._dotNetReference}}const windowAny=window;windowAny.DApi={};windowAny.interop=new Interop;const getInterop=()=>windowAny.interop;